git:
  depth: false
jobs:
  include:
    - stage: test
      name: 'Unit Tests'
      language: elixir
      elixir:
        - 1.6.6
        - 1.9.1
      otp_release:
        - 19.3
        - 22.1
      matrix:
        exclude:
          - elixir: 1.6.6
            otp_release: 22.1
          - elixir: 1.9.1
            otp_release: 19.3
      cache:
        directories:
          - _build
          - deps
      install:
        - bin/setup
      script:
        - MIX_ENV=test bin/test
    - stage: deploy
      if: branch = master
      script: skip
      deploy:
        provider: script
        script: bin/deploy
        on:
          all_branches: true
